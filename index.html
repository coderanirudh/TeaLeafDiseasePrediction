<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaf Disease Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEJf+qlm5D0M9z7evH0z5Jt2Ojk65f5twZx/Jh7zsm9+/p+VOFbH5C1A00tq" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body{
            text-align: center;
            font-family:sans-serif;
            justify-content: center;
            align-items: center;
            color: rgb(0, 0, 0);
            background-color: rgb(220, 220, 220);
        }
        .container {

            margin-top: 50px;
        }
        .image-container img {
        height: 100px;
        width: 100px;
            text-align: center;
        }
        .prediction-result {
            justify-content: center;
            margin-top: 30px;
        }
        .result-card {
           justify-items: center;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
         
        }
        .card-title {
            font-weight: bold;
        }
        .chart-container {
            width: 70%;
            margin: 0 auto;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center">Tea Leaf Disease Prediction</h2>
    <div class="image-container">
        <h4>Upload a Leaf Image for Prediction</h4>
        <form id="upload-form" action="/predict" method="POST" enctype="multipart/form-data">
            <input type="file" name="file" id="file" class="form-control" required>
            <button type="submit" class="btn btn-primary mt-3">Predict Disease</button>
        </form>
    </div>

    <!-- Image Display and Prediction Results -->
    <div class="prediction-result">
        <div id="image-display" class="image-container">
            <!-- The uploaded image will appear here -->
        </div>

        <div id="results" class="result-card">
            <!-- Prediction results will be displayed here -->
        </div>

        <div id="charts" class="chart-container">
            <!-- Charts will be displayed here -->
        </div>
    </div>
</div>

<script>
    // Form submission to handle image upload and prediction
    document.getElementById('upload-form').addEventListener('submit', function (e) {
        e.preventDefault();

        var formData = new FormData(this);
        
        // Show loading message or spinner
        document.getElementById('results').innerHTML = '<p>Processing...</p>';

        fetch('/predict', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Handle image display
            const fileInput = document.getElementById('file');
            const fileUrl = URL.createObjectURL(fileInput.files[0]);
            document.getElementById('image-display').innerHTML = `
                <img src="${fileUrl}" alt="Uploaded Image" style="max-width: 100%; height: auto; margin-top: 20px;">
            `;

            // Display prediction analysis
            const predictedClass = data.predicted_class;
            const results = data.results;

            // Display results in a card format
            let resultHTML = '<h5>Prediction Results:</h5><ul>';
            for (const model in results) {
                resultHTML += `<li><strong>${model}</strong>: ${predictedClass[model]}</li>`;
            }
            resultHTML += '</ul>';

            document.getElementById('results').innerHTML = resultHTML;

            // Plotting probabilities in bar charts using Chart.js
            const ctx = document.createElement('canvas');
            document.getElementById('charts').innerHTML = ''; // Clear previous chart
            document.getElementById('charts').appendChild(ctx);
            
            const chartData = {
                labels: ['algal leaf', 'gray light', 'healthy', 'Red leaf spot', 'white spot'],
                datasets: [
                    {
                        label: 'SVM Probability',
                        data: results['SVM'],
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'RandomForest Probability',
                        data: results['RandomForest'],
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'KNN Probability',
                        data: results['KNN'],
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'CNN Probability',
                        data: results['CNN'],
                        backgroundColor: 'rgba(255, 159, 64, 0.6)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    }
                ]
            };

            new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Disease Types'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Probability (%)'
                            },
                            beginAtZero: true,
                            ticks: {
                                stepSize: 10
                            }
                        }
                    }
                }
            });
        })
        .catch(error => {
            document.getElementById('results').innerHTML = '<p>Error occurred. Please try again.</p>';
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9gybB2X0P98QkWavQ8JlfHg7H9zqzPvvY12PcG6ZjzT2pu3//2s5" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-c5xdyvchT/uwBGOcG4Tkhs6KkKYoAqk6U5fg+xkGbzyYYA24D0khFw0iM2ffr3bb" crossorigin="anonymous"></script>
</body>
</html>
